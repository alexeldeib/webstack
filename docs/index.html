<head>
  <title>webstack</title>
  <link rel="shortcut icon" type="image/png" href="favicon.ico">
  <style>
    @import url('https://rsms.me/inter/inter.css');
    html { font-family: 'Inter', sans-serif; }
    @supports (font-variation-settings: normal) {
      html { font-family: 'Inter var', sans-serif; }
    }
    body {
      padding: 32px;
    }
    main,
    section {
      padding: 5px 32px;
    }
    iframe {
      border: none;
      width: 100%;
    }
    .dash-main {
      height: 580px;
    }
    .dash-serverless {
      height: 310px;
    }
    .dash-ruby {
      height: 450px;
    }
    p,
    li {
      line-height: 1.5em;
      max-width: 700px;
    }
  </style>
</head>
<body>
  <main>
    <h1>webstack</h1>
    <p>
      A project to prototype web stacks
      <a href="https://github.com/croaky/webstack">github.com/croaky/webstack</a>
    </p>
    <p>
      API checks from N. California, Montreal, Ireland, Stockholm, and Sydney:
    </p>
  </main>

  <iframe class="dash-main" src="https://webstack.checklyhq.com/"></iframe>

  <section>
    <h2>overview</h2>
    <p>
      This project is <a href="https://dancroak.com">my</a> attempt
      to prototype different web stacks. Each stack serves
      a healthcheck-style HTTP API endpoint that executes a
      <code>SELECT 1</code> to a SQL database
      and responds with JSON <code>{ "status": "ok" }</code>.
      Each stack hosts on a
      <a
          href="https://www.cloudflare.com/learning/serverless/glossary/platform-as-a-service-paas/">PaaS</a>
      and is built with a lightweight router, database connection pool, and
      database driver (no ORM).
    </p>
    <p>
      Right now, I'm playing with these hosting providers:
    </p>
    <ul>
      <li><a href="https://deno.com/deploy">Deno Deploy</a></li>
      <li><a href="https://encore.dev/">Encore</a></li>
      <li><a href="https://fly.io">Fly.io</a></li>
      <li><a href="https://netlify.com">Netlify</a></li>
      <li><a href="https://railway.app">Railway</a></li>
      <li><a href="https://render.com">Render</a></li>
      <li><a href="https://vercel.com">Vercel</a></li>
    </ul>
    <p>
      and these runtimes (w/ routers):
    </p>
    <ul>
      <li>Deno (<a href="https://oakserver.github.io/oak/">Oak</a>)</li>
      <li>Go (<a href="https://github.com/go-chi/chi">Chi</a>)</li>
      <li>Node (<a href="https://expressjs.com/">Express</a>)</li>
      <li>Ruby (<a href="http://sinatrarb.com/">Sinatra</a>)</li>
    </ul>
    <p>
      with these SQL databases:
    </p>
    <ul>
      <li><a href="https://www.postgresql.org/">Postgres</a></li>
      <li><a href="https://planetscale.com/">Planetscale</a></li>
    </ul>
  </section>

  <section>
    <h2>serverless</h2>
    <p>
      Three of the hosting providers are "serverless":
    </p>
    <ul>
      <li>Deno Deploy</li>
      <li>Netlify</li>
      <li>Vercel</li>
    </ul>
    <p>
      So far, I've tested
      <a href="https://github.com/croaky/webstack/tree/main/deno-deploy">Deno Deploy</a>
      and
      <a href="https://github.com/croaky/webstack/tree/main/vercel-go">Vercel's
        serverless Go functions</a>.
      Both used
      <a href="https://supabase.com/">Supabase</a>
      as the backend database.
    </p>
    <p>
      Serverless feels like it could be the future;
      it would be nice to manage fewer things.
      And, starting my career in the early 2000s reading books like
      <a
          href="https://www.amazon.com/Designing-Web-Standards-Jeffrey-Zeldman/dp/0321616952">Designing
      with Web Standards</a>,
      I especially like the web standard-focus of Deno.
    </p>
    <p>
      But, the serverful options feel a little more "standard" due to their
      maturity; the same Ruby, Node, or Go code is likely to run on Fly,
      Railway, Render, or Heroku without many tweaks.
    </p>
    <p>
      The latency is also higher for the serverless options, I'm guessing due to
      paying a TLS handshake cost, but would love to instrument and see how to
      bring these latencies down:
    </p>
  </section>

  <iframe class="dash-serverless" src="https://webstack-serverless.checklyhq.com/"></iframe>

  <section>
    <h2>heroku + ruby + postgres</h2>
    <p>
      From 2009-2017 and 2020-2022, my stack was Heroku + Ruby + Postgres.
      That stack strongly informs my priors. I'm wondering: what's better?
    </p>
  </section>
  <section>
    <h2>heroku</h2>
    <p>
      My Heroku setup was generally:
    </p>
    <ul>
      <li>
        Code versioned in a GitHub repo
      </li>
      <li>
        Open GitHub pull requests w/
        <a href="https://www.thoughtworks.com/continuous-integration">CI</a>
      </li>
      <li>
        Merge into <code>main</code> branch to auto-deploy to Heroku staging
        environment
      </li>
      <li>
        Promote staging manually to production environment in a
        <a href="https://devcenter.heroku.com/articles/pipelines">pipeline</a>
      <li>
        Configure Postgres database with a
        <a
          href="https://devcenter.heroku.com/articles/heroku-postgres-follower-databases">follower</a>
      </li>
    </ul>
    <p>
      Heroku's GitHub integration broke April 2022 in
      <a href="https://status.heroku.com/incidents/2413">incident 2413</a> and
      has not been restored.
      Heroku also lacks overdue features that Render now supports:
    </p>
    <ul>
      <li>
        HTTP/2 support
      </li>
      <li>
        <a href="https://render.com/docs/databases">IP access control on
          Postgres databases</a>
      </li>
      <li>
        <a href="https://render.com/docs/ddos-protection">DDoS
          protection</a>
      </li>
      <li>
        <a href="https://render.com/docs/deploys#zero-downtime-deploys">Health checks</a>
      </li>
    </ul>
  </section>

  <section>
    <h2>ruby</h2>
    <p>
      Ruby makes "developer happiness" a core goal but is not scoring well by
      that metric. See "most loved" in
      <a href="https://insights.stackoverflow.com/survey/2021#most-loved-dreaded-and-wanted-language-love-dread">Stack Overflow's
         annual developer survey</a>:
    </p>
    <ul>
      <li>87% Rust</li>
      <li>73% TypeScript</li>
      <li>72% Elixir</li>
      <li>68% Python</li>
      <li>64% Swift</li>
      <li>63% Go</li>
      <li>62% SQL</li>
      <li>62% Kotlin</li>
      <li>62% JavaScript</li>
      <li>60% HTML/CSS</li>
      <li>59% Crystal</li>
      <li>56% Bash</li>
      <li>53% Ruby</li>
      <li>49% C++</li>
      <li>47% Java</li>
      <li>40% C</li>
    </ul>
    <p>
      If the survey respondents are like me,
      they enjoy writing small Ruby programs but in larger programs,
      find it easier to understand and change code in
      in other stacks like Go.
    </p>
    <p>
      As part of this project, I hope to test <a href="https://sorbet.org/">Sorbet</a>.
      I suspect I'll feel similarly as
      <a
        href="https://brandur.org/fragments/large-scale-ruby-refactoring">Brandur
        here</a>.
    </p>
  </section>

  <iframe class="dash-ruby" src="https://webstack-ruby.checklyhq.com/"></iframe>

  <section>
    <h2>to be continued...</h2>
  </section>
</body>
